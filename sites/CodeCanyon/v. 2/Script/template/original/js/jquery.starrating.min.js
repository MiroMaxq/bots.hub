(function ($) {
    $.fn.starRating = function (options) {
        var settings = $.extend({
            stars: 5,
            current: 0,
            callback: function (value) {
            },
            static: false
        }, options);

        var $ul = this;
        var $li = ga('<li class="star"><i class="icofont icofont-star">&#xf0e6;</i></li>');

        if ($ul.hasClass('starrating-init')) {
            return;
        }

        if (this.attr('data-current')) {
            settings.current = this.attr('data-current');
        }

        if (this.attr('data-stars')) {
            settings.stars = this.attr('data-stars');
        }

        if (this.attr('data-static')) {
            settings.static = (this.attr('data-static') === '1' || this.attr('data-static') === 'true') ? true : settings.static;
        }

        for (var i = 0; i < settings.stars; i++) {
            var $clone = $li.clone();
            if (settings.current && i < settings.current) {
                $clone.addClass('active')
        }

            $ul.append($clone);
        }
        this.addClass('starrating-init');
		
		if(settings.static) this.addClass('staticrating');
		
		
        if (!settings.static || !this.hasClass('staticrating')) {
            $ul.find('li').on('click', function () {
				
				if(ga(this).closest('ul').hasClass('staticrating')) return;
				
                if (ga(this).hasClass('last')) {
                    $ul.find('li.active').removeClass('active last');
                    settings.callback(0);
                    return;
                }
                $ul.find('li.active').removeClass('active last');
                ga(this).addClass('active last');
                ga(this).prevAll().addClass('active');

                var selected = $ul.find('li.active').length;
				if(settings.stars < selected) {
					return displayErr(lang.err_tehnic);
					} else {
						
					settings.callback(selected);

					}
            }).hover(function () {
                $ul.addClass('hover');
                ga(this).addClass('hover');
                ga(this).prevAll().addClass('hover');
            }, function () {
                $ul.removeClass('hover');
                ga(this).removeClass('hover');
                ga(this).prevAll().removeClass('hover');
            });
        }

        return this;
    };
}(jQuery));
